---
title: "{ggconsort} - building programmatic CONSORT diagrams in ggplot"
author: "Peter DR Higgins"
institute: "University of Michigan"
date: "2020/08/27"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(xaringan)
library(xaringanthemer)
library(tidyverse)
```


class: top, left

# CONSORT diagrams

### To promote transparency

In clinical trials, a CONSORT diagram shows the flow of participants from screening to analysis, while identifying and providing reasons for dropout or exclusion of participants at each step along the way.
![image](consort5arm_upa_uc.png)

---

class: top, left

# CONSORT diagrams

### Endorsed by most medical journals

CONSORT = Consolidated Standards of Reporting Trials, developed by the CONSORT group, <http://www.consort-statement.org>, which started in 1993 to improve the quality of reporting of clinical trials.

![image](CONSORT_template.png)
---

class: top, left

# An Artisanal Product

- CONSORT diagrams are now commonly used, but the template provided does not provide an underlying data structure, or best practices for building a diagram. 
- The CONSORT diagram has become an artisanal product, built by counting categories and copy/pasting results into templates. 
- This leads to frequent errors in which the participant numbers don't add up. 
- Most CONSORT diagrams are built from templates in MS Word, Powerpoint, or Adobe Illustrator.

---
class: top, left
# Components of a Consort Diagram (Naming)
## insert marked up image here
- note top has N = 1 of each
- note bottom has N = n_arms of each
---
class: top, left
# Basic Functionality

## draw_consort(status_table)

- any # of arms from 2 to 8 (or more)
- auto-wraps text in boxes with _str_wrap()_
- can control text wrap with `\n`
- fits boxes to height, width of text
- creates lines and arrows to box center edges
- sets standard vertical and horizontal spacing between boxes, lines
- creates plot area sufficient to contain diagram
- then draws the diagram


---
class: top, left
# Under the Hood

- requires a standardized status_table as input
- counts number of participants in each box/arm
- creates text for each box in a box_table
- calculates height, width, center of boxes in box_table
- calculates position of each box in box_table
- calculates start, end of each line (one without arrowhead)


---

class: top, left
# Demo for 2 arms


---

class: top, left
# Demo for 5 arms

---

class: top, left
# Demo for 8 arms

---

class: top, left
# Requirements of a Status Table
- One row per candidate participant
- includes both
  + randomized participants, and
  + candidate participants excluded (aka screen failures)
  <br>
- (optional) column - studyid
- column `randomized` - yes or NA
- column `excluded_reason` - Text or NA
- column `arm` - Text per Arm or NA
- column `completed` - yes or NA
- column `discontinued_reason` - Text or NA
- column `analyzed` -  yes or NA
- column `not_analyzed_reason` - Text or NA
---
class:top, left
# The Package and Repository

---
class:top, left
# The Hex Sticker

Because one must always have a hex sticker


```{r, echo=FALSE, out.width="55%", fig.cap="A nice image."}
knitr::include_graphics("hex-ggconsort.png")
```

---
class:top, left
# Feedback and Collaborators Wanted!
## Goals
- More (and better) vignettes
- A better README
- Helper functions to take standard data formats (tidycdisc?) and make a status_table
- more options, arguments - currently like the model T.
- You can have any font or spacing that you want, as long as it is the default.
