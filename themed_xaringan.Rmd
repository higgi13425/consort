---
title: "{ggconsort} - building programmatic CONSORT diagrams in ggplot"
author: "Peter DR Higgins"
institute: "University of Michigan"
date: "2020/08/27"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(xaringan)
library(xaringanthemer)
library(tidyverse)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#292077" ,
  secondary_color = "#8c54fc",
  inverse_header_color = "#FFFFFF"
)
```
class: header_background, center
# {ggconsort}


```{r, echo=FALSE, out.width="57%"}
knitr::include_graphics("hex-ggconsort.png")
```

---

class: header_background

# CONSORT diagrams

### To promote transparency

In clinical trials, a CONSORT diagram shows the flow of participants from screening to analysis, while identifying and providing reasons for dropout or exclusion of participants at each step along the way.
![image](consort5arm_upa_uc.png)

---

class: header_background

# CONSORT diagrams

### Endorsed by most medical journals
.pull-left[
CONSORT = Consolidated Standards of Reporting Trials, developed by the CONSORT group, <http://www.consort-statement.org>, which started in 1993 to improve the quality of reporting of clinical trials.
]
.pull-right[
![image](CONSORT_template.png)
]
---

class: header_background

# An Artisanal Product

- CONSORT diagrams are now commonly used, but the template provided does not provide an underlying data structure, or best practices for building a diagram. 
- The CONSORT diagram has become an artisanal product, built by counting categories and copy/pasting results into templates. 
- This leads to frequent errors in which the participant numbers don't add up. 
- Most CONSORT diagrams are built from templates in MS Word, Powerpoint, or Adobe Illustrator.

---

class: header_background

# Naming Diagram Components
### insert marked up image here
- note top has N = 1 of each
- note bottom has N = n_arms of each
---

class: header_background

# Basic Functionality

## draw_consort(status_table)

- any # of arms from 2 to 8 (or more)
- auto-wraps text in boxes with _str_wrap()_
- can control text wrap with `\n`
- fits boxes to height, width of text
- creates lines and arrows to box center edges
- sets standard vertical and horizontal spacing between boxes, lines
- creates plot area sufficient to contain diagram
- then draws the diagram


---

class: header_background
# Under the Hood

- requires a standardized status_table as input
- counts number of participants in each box/arm
- creates text for each box in a box_table
- calculates height, width, center of boxes in box_table
- calculates position of each box in box_table
- calculates start, end of each line (one without arrowhead)


---

class: header_background

# Demo for 2 arms

---

class: header_background
# Demo for 5 arms

---

class: header_background
# Demo for 8 arms

---

class: header_background
# Requirements of a Status Table
- One row per candidate participant
- Includes both
  + randomized participants
  + and candidate participants excluded (aka screen failures)
  
- (optional) column - studyid
- column `randomized` -             Yes or NA
- column `excluded_reason` -        Text or NA
- column `arm` -                    Text per Arm or NA
- column `completed` -              Yes or NA
- column `discontinued_reason` -    Text or NA
- column `analyzed` -               Yes or NA
- column `not_analyzed_reason` -    Text or NA

---

class: header_background
# Example of a Status Table



---
class: header_background
# The Package and Repository
.center[
https://github.com/higgi13425/ggconsort
]

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("github-ggconsort.png")
```
---
class: header_background
# The Hex Sticker

```{r, echo=FALSE, out.width="53%", fig.cap="Because one must always have a hex sticker", fig.align='center'}
knitr::include_graphics("hex-ggconsort.png")
```



---
class: header_background
# Collaborators Wanted!
## Goals
- More (and better) vignettes
- A better README
- Helper functions to take standard data formats and make a status_table
  + CDISC
  + tidycdisc?
  + ADaM
- more options, arguments - currently like the model T.
- You can have any font or spacing that you want, as long as it is the default.

---
class: inverse, center, middle

# Thanks!

---

